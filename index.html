<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chúc mừng sinh nhật</title>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background-color: black;
      font-family: 'Great Vibes', cursive;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: black;
      overflow: hidden;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      display: block;
    }
    #threeCanvas {
      z-index: 5;
      pointer-events: none;
      display: none;
    }
    .text {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      color: #fff;
      font-size: 8vw;
      text-align: center;
      opacity: 0;
      z-index: 3;
      transition: transform 1s ease, opacity 1s ease;
      text-shadow: 0 0 20px rgba(255, 182, 193, 0.6);
    }
    .show { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    .hide { opacity: 0; transform: translate(-50%, -50%) scale(0); }
  </style>
</head>
<body>

<canvas id="loveRain"></canvas>
<canvas id="threeCanvas"></canvas>

<div class="text" id="line1">Birthday 25+</div>
<div class="text" id="line2">13/11/2000</div>
<div class="text" id="line3">Wish Trâm Anh always happy</div>
<div class="text" id="line4">Wish all the best things come to<br>Trâm Anh &lt;3</div>

<script>
// ========== Hiệu ứng mưa LOVE ==========
const rainCanvas = document.getElementById('loveRain');
const rctx = rainCanvas.getContext('2d');
function resizeRain() {
  rainCanvas.width = innerWidth;
  rainCanvas.height = innerHeight;
}
resizeRain();
window.addEventListener('resize', resizeRain);

const letters = "LOVE".split("");
const fontSize = 20;
let drops = [];
function setupRain() {
  const columns = Math.floor(rainCanvas.width / fontSize);
  drops = Array(columns).fill(1);
}
setupRain();
function drawRain() {
  rctx.fillStyle = "rgba(0,0,0,0.1)";
  rctx.fillRect(0, 0, rainCanvas.width, rainCanvas.height);
  rctx.fillStyle = "#ff8ed6";
  rctx.font = fontSize + "px monospace";
  for (let i = 0; i < drops.length; i++) {
    const text = letters[Math.floor(Math.random() * letters.length)];
    rctx.fillText(text, i * fontSize, drops[i] * fontSize);
    if (drops[i] * fontSize > rainCanvas.height && Math.random() > 0.975) drops[i] = 0;
    drops[i]++;
  }
}
setInterval(drawRain, 33);

// ========== Dòng chữ ==========
const lines = [
  document.getElementById("line1"),
  document.getElementById("line2"),
  document.getElementById("line3"),
  document.getElementById("line4")
];
let current = 0;
function showNextLine() {
  if (current > 0) {
    lines[current - 1].classList.remove("show");
    lines[current - 1].classList.add("hide");
  }
  if (current < lines.length) {
    setTimeout(() => {
      lines[current].classList.add("show");
      current++;
      setTimeout(showNextLine, 4000);
    }, 1000);
  } else {
    setTimeout(drawCake3D, 1500);
  }
}
showNextLine();

// ========== Bánh sinh nhật 3D chấm sáng ==========
function drawCake3D() {
  const canvas = document.getElementById('threeCanvas');
  canvas.style.display = "block";
  const ctx = canvas.getContext("2d");
  canvas.width = innerWidth;
  canvas.height = innerHeight;

  const cx = canvas.width / 2;
  const cy = canvas.height / 2 + 80;
  const scale = Math.min(innerWidth, innerHeight) / 600;
  const angleX = -0.8;

  const layers = [
    { r: 180, h: 40, y: 0 },
    { r: 130, h: 35, y: 50 },
    { r: 85,  h: 30, y: 90 }
  ];

  const dots = [];
  layers.forEach(l => {
    const topColor = "#ff9bd6";
    const sideColor = "#ffffff";
    const edgeColor = "#ffd966";

    // mặt trên
    for (let ang = 0; ang < Math.PI * 2; ang += Math.PI / 48) {
      for (let r = 0; r <= l.r; r += 8) {
        dots.push({x: Math.cos(ang)*r, y: l.y + l.h/2, z: Math.sin(ang)*r, color: topColor});
      }
    }
    // thân
    for (let ang = 0; ang < Math.PI * 2; ang += Math.PI / 36) {
      for (let j = -l.h/2; j <= l.h/2; j += 4) {
        dots.push({x: Math.cos(ang)*l.r, y: l.y + j, z: Math.sin(ang)*l.r, color: sideColor});
      }
    }
    // viền
    for (let ang = 0; ang < Math.PI * 2; ang += Math.PI / 32) {
      dots.push({x: Math.cos(ang)*(l.r+3), y: l.y + l.h/2 + 2, z: Math.sin(ang)*(l.r+3), color: edgeColor});
    }
  });

  // nến và lửa
  const top = layers[2];
  const candleCount = 12;
  for (let i = 0; i < candleCount; i++) {
    const ang = (i / candleCount) * Math.PI * 2;
    const x = Math.cos(ang) * (top.r - 10);
    const z = Math.sin(ang) * (top.r - 10);
    for (let j = 0; j < 15; j++) {
      dots.push({x, y: top.y + top.h/2 + j*2, z, color: "#ff4d4d"});
    }
    for (let k = 0; k < 6; k++) {
      dots.push({x: x+(Math.random()-0.5)*2, y: top.y+top.h/2+35+k, z: z+(Math.random()-0.5)*2, color:"#ffd966", flicker:true});
    }
  }

  // tạo vị trí bắt đầu (ở giữa)
  dots.forEach(p => {
    p.sx = 0;
    p.sy = 0;
    p.sz = 0;
    p.tx = p.x;
    p.ty = p.y;
    p.tz = p.z;
  });

  const flyDuration = 2000; // 2 giây bay ra
  const startTime = performance.now();
  let angleY = 0;
  let flyDone = false;

  function render(now) {
    const elapsed = now - startTime;
    const progress = Math.min(elapsed / flyDuration, 1);

    if (progress >= 1) flyDone = true;
    if (flyDone) angleY += 0.0025;

    const sinY = Math.sin(angleY), cosY = Math.cos(angleY);
    const sinX = Math.sin(angleX), cosX = Math.cos(angleX);
    const t = Date.now() * 0.005;

    ctx.fillStyle = "rgba(0,0,0,0.25)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    dots.forEach(p => {
      // vị trí bay ra
      const xNow = p.sx + (p.tx - p.sx) * progress;
      const yNow = p.sy + (p.ty - p.sy) * progress;
      const zNow = p.sz + (p.tz - p.sz) * progress;

      // xoay nếu đã hoàn tất bay ra
      const xz = xNow * cosY - zNow * sinY;
      const zz = xNow * sinY + zNow * cosY;
      const yz = yNow * cosX - zz * sinX;
      const zz2 = yNow * sinX + zz * cosX;

      const perspective = 400 / (400 + zz2);
      const x2d = cx + xz * scale * perspective * 1.5;
      const y2d = cy - yz * scale * perspective;
      const size = 2.2 * perspective + 0.5;

      if (p.flicker) {
        const f = 0.8 + 0.2 * Math.sin(t + xz * 0.1);
        ctx.globalAlpha = f;
      } else {
        ctx.globalAlpha = Math.min(1, Math.max(0.4, perspective));
      }

      ctx.beginPath();
      ctx.fillStyle = p.color;
      ctx.arc(x2d, y2d, size, 0, Math.PI * 2);
      ctx.fill();
    });
    ctx.globalAlpha = 1;
    requestAnimationFrame(render);
  }
  requestAnimationFrame(render);
}
</script>
</body>
</html>

